## Chapter 05 트랜잭션과 잠금
</br>

-------------------------------------------------------------------------
## Introduction </br>

MySQL의 동시성에 영향을 미치는 요소

1) 잠금 (Lock)
2) 트랜잭션 (Transation)
3) 트랜잭션의 격리수준 (Isolation level)
</br>


## 잠금
    동시성을 제어하기 위한 기능이다.
    -> 여러 커넥션에서 동시에 동일한 자원을 요청할 경우
       순서대로 한 시점에는 하나의 커넥션만 변경할 수 있게 해준다.

## 격리수준
    하나의 트랜잭션 또는 여러 트랜잭션 간의 작업 내용을 어떻게 공유하고
    차단할 것인지를 결정하는 레벨을 의미한다.

-------------------------------------------------------------------------

### 5.1 트랜잭션

- 의미 : 데이터의 정합성을 보장하기 위한 기능
- TCL(Transaction Control Language) 
    - rollback : 논리적인 작업 셋 자체가 100% 적용되지 않음
    - commit : 논리적인 작업 셋 자체가 100% 적용
</br>

### \[MyISAM 과 InnoDB 트랜잭션 관점에서의 비교]


- MyISAM : 트랜잭션 지원되지 않아 일부가 적용
</br>
 -> 부분 업데이트 현상은 테이블 데이터의 정합성을 맞추는데 어려운 문제를 만들어낸다. 

```sql
mysql> CREATE TABLE tab_myisam ( fdpk INT NOT NULL, PRIMARY KEY(fdpk) ) ENGINE=MyISAM;
mysql> INSERT INTO tab_myisam (fdpk) VALUES (3);

mysql> INSERT INTO tab_myisam (fdpk) VALUES (1),(2),(3);
mysql> SELECT * FROM tab_myisam;
```
| fdpk |
|---|
|   1|
|   2|
|   3|

</br>

- InnoDB : 트랜잭션이 지원되어 에러발생 시 Rollback으로 전부 적용되지 않음

```sql
mysql> CREATE TABLE tab_innodb ( fdpk INT NOT NULL, PRIMARY KEY(fdpk) ) ENGINE=INNODB;
mysql> INSERT INTO tab_innodb (fdpk) VALUES (3);

mysql> INSERT INTO tab_innodb (fdpk) VALUES (1),(2),(3);
mysql> SELECT * FROM tab_innodb;
```
| fdpk |
|---|
|   3|
</br>

### \[주의사항]

- 프로그램의 코드가 DB connection을 가지고 있는 범위 최소화
- 트랜잭션 활성화된 프로그램의 범위를 최소화
- 네트워크 작업이 존재하는 경우 반드시 트랜잭션에서 배제